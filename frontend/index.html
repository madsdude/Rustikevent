<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Rustik Event</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/_shared.css"/>
  <meta name="description" content="Koncerter & events i Randers — Rustik Event"/>

  <!-- Google tag (gtag.js) + Consent Mode v2 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HZD2H5MK76"></script>
  <script>
    // DataLayer + helper
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    // EU: start med 'denied' indtil bruger giver samtykke
    gtag('consent', 'default', {
      ad_storage: 'denied',
      analytics_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      wait_for_update: 500
    });

    // Init
    gtag('js', new Date());

    // Kun track i prod (ikke localhost)
    if (location.hostname !== 'localhost') {
      gtag('config', 'G-HZD2H5MK76', {
        transport_type: 'beacon'
      });
    }
  </script>
</head>
<body>
  <nav class="nav container">
    <div class="logo">R<span style="color:var(--neon)">EVENTS</span></div>
    <div class="nav-right">
      <a class="btn" href="/kalender.html">Kalender</a>
      <a class="btn" href="https://redir.greeter.dk/s/book-rustik-randers" target="_blank">Book bord</a>
      <a class="btn" href="/admin.html">Admin</a>
    </div>
  </nav>

  <header class="hero container">
    <h1>Rustik Event</h1>
    <p>Live musik, DJ-nætter og særlige events — i hjertet af Randers.</p>
    <div style="margin-top:1rem;display:flex;gap:.8rem;justify-content:center;flex-wrap:wrap">
      <a class="btn" href="/kalender.html">Se kalender</a>
      <a class="btn" href="https://redir.greeter.dk/s/book-rustik-randers" target="_blank">Book bord</a>
      <a class="btn" href="https://www.facebook.com/profile.php?id=61577769481002" target="_blank">Facebook</a>
    </div>
  </header>

  <main class="container">
    <section>
      <h2>Kommende events</h2>
      <div id="events" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(260px,1fr))"></div>
    </section>
  </main>

  <footer class="footer">© <span id="year"></span> Rustik Event · Randers · 18+</footer>

  <!-- Cookie-banner (simpelt) -->
  <div id="cookie-banner" style="position:fixed;left:0;right:0;bottom:0;padding:12px 16px;background:#0b0b0f;border-top:1px solid #1f2937;color:#fff;display:flex;gap:12px;align-items:center;justify-content:space-between;z-index:9999;box-shadow:0 -8px 30px rgba(0,0,0,.35);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif">
    <div style="max-width:70ch;font-size:14px;line-height:1.4">
      Vi bruger cookies til statistik (Google Analytics). Læs mere i vores privatlivspolitik. Accepterer du?
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="rejectCookies()" class="btn" style="padding:8px 12px;border:1px solid #334155;background:#111827;color:#e5e7eb;border-radius:8px;cursor:pointer">Afvis</button>
      <button onclick="acceptCookies()" class="btn" style="padding:8px 12px;border:0;background:var(--neon,#39FF14);color:#09110b;font-weight:700;border-radius:8px;cursor:pointer">Acceptér</button>
    </div>
  </div>

  <script>
  // Events + footer-år
  const el = document.getElementById('events');
  const year = document.getElementById('year'); year.textContent = new Date().getFullYear();
  fetch('/api/events').then(r=>r.json()).then(list=>{
    const todayStr = new Date().toISOString().slice(0,10);
    const upcoming = list.filter(e=>e.date >= todayStr);
    if(upcoming.length===0){ el.innerHTML = '<p>Ingen planlagte events endnu. Følg os på Facebook for nyheder.</p>'; return; }
    el.innerHTML = upcoming.map(e=>`
      <article class="card">
        ${e.poster_url?`<img src="${e.poster_url}" alt="${e.title}" referrerpolicy="no-referrer" onerror="this.onerror=null;this.src='/img/placeholder.jpg'">`:''}
        <div style="padding:1rem">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem">
            <h3 style="margin:.2rem 0">${e.title}</h3>
            ${e.status==='soldout'?'<span class="badge">Udsolgt</span>':''}
            ${e.status==='cancelled'?'<span class="badge">Aflyst</span>':''}
          </div>
          <p style="opacity:.9;margin:.4rem 0">${e.date}${e.start?` · kl. ${e.start}`:''} · ${e.age||'18+'}</p>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem">
            <a class="btn" href="https://redir.greeter.dk/s/book-rustik-randers" target="_blank">Book bord</a>
            ${e.facebook_url?`<a class="btn" href="${e.facebook_url}" target="_blank">Facebook</a>`:''}
          </div>
        </div>
      </article>
    `).join('');
  }).catch(()=>{ el.innerHTML = '<p>Kan ikke hente events lige nu.</p>';});

  // Cookie-consent logik
  const CONSENT_KEY = 'cookie_consent_v1';
  const savedConsent = localStorage.getItem(CONSENT_KEY);
  const banner = document.getElementById('cookie-banner');

  if (savedConsent === 'granted') {
    banner.style.display = 'none';
    grantConsent();
  } else if (savedConsent === 'denied') {
    banner.style.display = 'none';
    // behold default denied
  }

  function grantConsent(){
    gtag('consent', 'update', {
      ad_storage: 'granted',
      analytics_storage: 'granted',
      ad_user_data: 'granted',
      ad_personalization: 'granted'
    });
  }
  function acceptCookies(){
    localStorage.setItem(CONSENT_KEY, 'granted');
    grantConsent();
    banner.style.display = 'none';
  }
  function rejectCookies(){
    localStorage.setItem(CONSENT_KEY, 'denied');
    // forbliv 'denied'
    banner.style.display = 'none';
  }
  </script>
</body>
</html>
